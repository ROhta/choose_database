# 安易に立てるな
# データベース
### ～そのデータ何処で持つ？～

太田

---

- データベースから取ってくる
- サーバサイドのプログラムで変数に突っ込む
- クライアントに渡す
- クライアントのプログラムの変数に突っ込む
- 表示

---

### データが存在する場所

- サーバサイド |
  - データストア |
  - キャッシュ |
  - グローバル変数 |
- クライアントサイド |

---

### サーバサイド

---


---

### データストア

- RDB
  - 列志向
  - 行志向
- KVS
- DocumentDB

---

### キャッシュ

---

- Redis
- Memcached

---

使うならRedis
- memcachedでできてRedisで出来ないことはない
- Redisでできてmemcahedで出来ないことはある
  - データの半永続化
  - レプリケーション
  - ソート

---

### グローバル変数

---

- GC
- スレッドセーフ
- 上書き不可

---

### クライアントサイド

---

- cookie
- WebStorage
  - localStorage
  - sessionStorage
- webSQL
- IndexedDB


---
### cookie

- 保存容量4KB~~オワコン~~
- サーバにデータを自動送信
- 有効期限設定あり

---
### localStorage

- 保存容量5MB
- データ送信しない
- 有効期限設定なし（jsで自分で消す）

- KVS
- 同一ドメイン内で有効

---
### sessionStorage

- 保存容量5MB
- データ送信しない
- 有効期限設定なし（jsで自分で消す）
- 同一タブ内で有効

---
### webSQL

- ブラウザ上でSQLiteが使える
- 廃止されたからIndexedDBを使え、と[googleが言っている](https://developers.google.com/web/tools/lighthouse/audits/web-sql?hl=ja)

---
### IndexedDB

- テーブル1つのみのRDB、というイメージ
  - 結合や外部キー制約はなし
  - 文字列以外も保存可能
  - key以外で検索可能
  - トランザクションがある＝非同期処理もいける
- 保存容量めっちゃいっぱい（up to quata）
  - 端末の空き容量による


### 使いどき

- cookieとwebSQL
  - 無い
- webStorage
  - 手軽に使いたい（保存容量少ない）とき
  - 同期処理で問題ないとき
  - データのタブ間共有をしたくないときのみsessionStorage
- Indexed DB
  - ガチな（保存容量・種類が多い）とき
  - 非同期処理（トランザクション）の必要があるとき
  - 検索したいとき
  - 文字列以外も保存したいとき

---

時間があれば実演

---

### まとめ

最高の設計と実装は、お互いの尊重する雰囲気の下でプロダクションとプロダクトに対する関心が1つになったときに生まれるもので、それこそがSREが約束するものです。

『SRE サイトリライアビリティエンジニアリング -Googleの信頼を支えるエンジニアリングチーム』
第31章 SREにおけるコミュニケーションとコラボレーションより
